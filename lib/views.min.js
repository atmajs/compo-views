/*!
 * Form Component v0.10.21
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2016 Atma.js and other contributors
 */
"use strict";!function(t,e){var n="undefined"!=typeof global?global:window,r=n.mask||n.atma&&n.atma.mask;if(null==r){if("function"!=typeof require)throw Error("MaskJS was not loaded");mask=require("maskjs")}e(n,r,r.jmask,r.Compo,r.Compo.config.getDOMLibrary())}(void 0,function(t,e,n,r,i){var o,s,a;!function(){s=function(t){return Object.prototype.toString.call(t).replace("[object ","").replace("]","")},function(){a=function(t){if(null==t||"object"!=typeof t)return t;var e,n=s(t);if("Date"===n)return new Date(t);if("Array"===n){e=[];for(var r=-1,i=t.length;++r<i;)e[r]=a(t[r]);return e}if("Object"===n){e={};for(var o in t)e[o]=a(t[o]);return e}return t}}(),o=function(t,e){var n=void 0===arguments[2]?{}:arguments[2];if(null==t)return n;var r=s(t);if("Array"===r)return t.forEach(function(t,r){o(t,e+"["+r+"]",n)}),n;if("Object"===r){e&&(e+=".");var i,a,u;for(i in t)if(a=t[i],u=e+i,null!=a){var r=s(a);switch(r){case"Object":case"Array":o(a,u,n);continue;case"String":case"Number":case"Boolean":case"Blob":case"File":u in n&&console.warn("ToFormData: Overwrite property",u),n[u]=a;continue;case"Date":n[u]=a.toISOString();continue;default:console.error("Possible type violation",r),n[u]=a;continue}}return n}switch(r){case"Date":t=t.toISOString();break;case"String":case"Number":case"Boolean":case"Blob":case"File":break;default:console.error("Possible type violation",r)}return e in n&&console.warn("ToFormData: Overwrite property",e),n[e]=t,n}}();var u;!function(){u=function(t,n){e.TreeWalker.walk(t,function(e){return e!==t?n(e):void 0})}}();var c;!function(){c=function(n){return e.obj.get(n,"req.url")||t.location.pathname+t.location.search}}();var l,h={NONE:0,LOADING:1,LOADED:2,RENDERING:3,RENDERED:4},f=e["class"].create({viewNode:null,nodes:null,compo:null,route:null,state:h.NONE,path:null,"default":!1,constructor:function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];for(var i=n.length,o=-1;++o<i;){var s=n[o];null!=s&&e.obj.extend(this,s)}},getNodes:function(){return null!=this.viewNode?(null!=this.path&&null==this.viewNode.nodes&&(this.viewNode.nodes=e.parse("import from '"+this.path+"'")),this.viewNode):this.nodes}}),v={ensure:function(t,n,r){var i=t.viewmap;if(null!=i)return i;var o=e.Utils.Expression.eval;return i=t.scope.viewmap||t.xViewmap&&o(t.xViewmap,n,r,t)||{},e.jmask(t.nodes).filter("View").map(v.createViewDataFromNode).each(function(t){i[t.route]=new f(i[t.route],t)}),t.viewmap=i},createRoutes:function(t){for(var e in t.viewmap)t.routes.add(e,t.viewmap[e])},createViewDataFromNode:function(t){return new f({viewNode:t,route:t.attr.route,path:t.attr.path,"default":Boolean(t.attr["default"])})},getRouteByPath:function(t,e){var n=t.routes,r=n.get(e);if(r)return r;var i=t.viewmap;for(var o in i)if(i[o]["default"]===!0)return n.get(o);return null},bindRouter:function(t,e,n){var r=v.ensure(t,e,n);if(null==r)return void console.error("Viewmap is undefined");if(t.xNested!==!0||t.isNested()!==!0)for(var i in r)console.log("BIND",i),ruta.add(i,function(e){t.navigate(e.current.path)})}};!function(){l=e["class"].create(Object.defineProperties({tickStart:null,tickEnd:null,history:null,vm:null,constructor:function(t){this.history=[],this.routes=[],this.vm=t},show:function(t,e){var n,r=this,i=this.routes.indexOf(t);return-1===i?(t.dfr=n=e(),this.routes.push(t)):n=this.routes[i].dfr,this.history.push({current:t.current,route:t}),this.requestProgressStart(),n.done(function(){return r.requestProgressEnd(t)}).fail(function(){})},clear:function(t){var e=this.routes.indexOf(t);-1!==e&&(t.dfr=null,t.value.compo=null,this.routes.splice(e,1))},requestProgressStart:function(t){this.cancelProgressEnd(),this.tickStart=setTimeout(this.progressStart.bind(this,t))},requestProgressEnd:function(t){this.cancelProgressStart(),this.tickEnd=setTimeout(this.progressEnd.bind(this,t))},cancelProgressStart:function(){clearTimeout(this.tickStart)},cancelProgressEnd:function(){clearTimeout(this.tickEnd)},progressStart:function(){this.cancelProgressEnd(),this.vm.emitIn("viewActivity","start")},progressEnd:function(t){(null==t||this.current===t)&&(this.cancelProgressStart(),this.cancelProgressEnd(),this.vm.emitIn("viewActivity","end"))},back:function(){return this.history.pop(),this.history.pop()}},{current:{get:function(){var t=this.history[this.history.length-1];return t&&t.route},configurable:!0,enumerable:!0}}))}();var d;!function(){d=e["class"].create({vm:null,constructor:function(t){this.vm=t},show:function(t){var e=function(e,n){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(t,e){var n=this,r=this.getShow(t),i=this.getHide(e);return r.parallel?(this.hide_(i,e),void this.show_(r,t)):void this.hide_(i,e).then(function(){return n.show_(r,t)})}),show_:function(t,n){var r=this;return e["class"].Deferred.run(function(e){r.vm.showCompo_(n.value.compo).then(function(){var r=n.value.compo.$[0];t.start(e,r)})})},hide_:function(t,n){var r=this;return e["class"].Deferred.run(function(e){return null==n.value.compo?void e():void t.start(function(){r.vm.hideCompo_(n.value.compo).then(e)},n.value.compo.$[0])})},getShow:function(t){return this.getAniForRoute(t,"show")},getHide:function(t){return this.getAniForRoute(t,"hide")},getAniForCompo:function(t,n){return e.jmask(t).children("Animation#"+n)[0]},getAniForRoute:function(e,n){var r=this.getAniForCompo(e.value.compo,n);return null==r&&(r=this.getAniForCompo(this.vm,n)),r?r:t}});var t={attr:{},start:function(t){t()}}}();var p=e.Compo({tagName:"div",attr:{style:"position: relative","class":"v-manager"},meta:{attributes:{base:"",viewmap:"",routing:!0,nested:!0}},slots:{viewNavigate:function(t,e,n){var r=this;if(t!==this){var i=this.route,o=i&&i.value&&i.value.compo;return this.navigate(e,n,{defaultView:!1}).done(function(){i===r.route&&o.emitIn("viewActivation",r.route.current.params)}),!1}},viewActivation:function(t){if(t!==this){this.route&&this.route.value&&this.route.value.compo;return!1}},viewDeactivation:function(t){var e=this.route&&this.route.value&&this.route.value.compo;return e&&e.emitIn("viewDeactivation"),!1},back:function(t){var e=this.activityTracker.back();this.navigate(e.current.path)}},scope:{notificationMsg:"",notificationType:""},viewmap:null,routes:null,route:null,next:null,activity:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];this.emitIn.apply(this,["views:activity",t].concat(n))},constructor:function(){this.routes=new ruta.Collection},onRenderStart:function(t,e){v.ensure(this,t,e),v.createRoutes(this);var r=c(e),i=v.getRouteByPath(this,r);this.attr.path=r,this.route=i,this.nodes=n().add(this.getCompo_("Notification")).add(this.getCompo_("Progress")).add(this.getCompo_("Animation"),!1).add(i&&i.value.getNodes()),e.params=i&&i.current&&i.current.params},onRenderEnd:function(t,e,n){var i=this;if(this.activityTracker=new l(this),this.viewChanger=new d(this),this.ctx=n,v.ensure(this,e,n),this.xRouting&&v.bindRouter(this,e,n),null==this.route&&null!=this.attr.path&&(this.route=v.getRouteByPath(this,this.attr.path)),null!=this.route){var o=this.route.value,s=this.find("View");null!=s&&s.emitIn("viewActivation"),o.compo=s,this.activityTracker.show(this.route,function(){return r.await(i)})}},getCtx:function(t){var n=e.obj.extend(null,this.ctx);return n.params=t.current.params,n},isNested:function(){var t=r.closest(this.parent,"ViewManager");return null!=t},navigate:function(t,n,r){var i=this,o=v.getRouteByPath(this,t);if(null==o){var s=new e["class"].Deferred;return r&&r.defaultView===!1?s.resolve(this.route):s.reject("View not found: "+t)}var a=null==o.value.compo;return this.activityTracker.show(o,function(){return i.renderView(o,n)}).done(function(){a===!1&&o.value.compo.emitIn("viewNavigate",t),i.performShow(o)})},hideCompo_:function(t){return null!=t?(t.emitIn("viewDeactivation",this),t.hide_()):void 0},showCompo_:function(t){return null!=t?(t.emitIn("viewActivation",this),t.show_()):void 0},emit:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];(e=r.pipe("views")).emit.apply(e,[t,this].concat(i))},activate:function(t){compo.emitIn("viewActivation",t.current.params)},renderView:function(t,n){var i=this;return e["class"].Deferred.run(function(o,s,a){if(t.value.compo)return void o(t);var u=i.getCtx(t);e.renderAsync(t.value.getNodes(),n,u,null,i).done(function(e,n){var i=n.components[n.components.length-1],s=r.prototype.find.call(i,"View");t.value.compo=s,o(t)})})},performShow:function(t){var e=this.route;e!==t&&(this.route=t,this.viewChanger.show(t,e),null!=e&&null!=e.value.compo&&e.value.compo.xRecycle===!0&&this.activityTracker.clear(e))},notify:function(t,e){0===arguments.length&&(t=e=""),this.scope.notificationType=t,this.scope.notificationMsg=e,this.emitIn("formNotification",{type:t,message:e})},getCompo_:function(t){var e=void 0===arguments[1]?!0:arguments[1],r=n(this).children(t);return e===!1?r:0===r.length?n(t):r},throw_:function(t){this.nodes=e.parse("\n			div style='background: red; color: white; padding: 15px; font-weight: bold' {\n				\""+t.message+'"\n			}\n		')},errored_:function(t){this.activity("end"),this.activity("error",t),this.notify("danger",t.message||String(t))}}),m="\n	// source Notification.mask\n	let Notification as (div) {\n		\n		slot formNotification () {\n			var form = this.closest('a:form');\n			if (!form.scope.notificationMsg) {\n				return;\n			}\n			var el = this.$.get(0);\n			if (el) {\n				el.scrollIntoView(true);\n			}\n		}\n		\n		@if (template) {\n			@template;\n		}\n		@else {\n			+if (notificationMsg) {\n				.alert.alert-~[bind: $scope.notificationType] > '~[bind: $scope.notificationMsg ]'\n			}\n		}\n	}\n	// end:source Notification.mask\n	// source Progress.mask\n	let Progress {\n		var value = -1;\n		var progress = false;\n	\n		slot viewActivity (sender, type, percent) {\n			if (type === 'start') {\n				this.scope.progress = true;\n			}\n			if (type === 'end') {\n				this.scope.progress = false;\n			}\n			if (type === 'progress' && typeof percent === 'number') {\n				this.scope.value = percent;\n			}\n		}\n	\n		.-a-views-progress style='display: ~[bind: $scope.progress ? \"block\" : \"none\" ]'{\n	\n			progress value='~[bind: $scope.value == -1 ? null : $scope.value]' max=100;\n	\n			style scoped {\n				progress {\n					display: block;\n					margin: auto;\n					width: 98%;\n					height: 3px;\n				}\n			}\n		}\n	}\n	// end:source Progress.mask\n";e.define(p,m);var g;!function(){var t=1,n=2,i=3,o=5;g=r({meta:{attributes:{"default":!1,detach:!0,recycle:!1}},slots:{viewDeactivation:function(){return this.state===o?!1:void(this.state=o)}},tagName:"div",attr:{"class":"v-view",style:"position:relative"},onRenderStart:function(){},state:t,hide_:function(){var t=this;return this.hide().then(function(){if(t.xRecycle===!0)return void t.remove();if(t.xDetach===!0){t.state=n;var e=t.$.detach||t.$.remove;e.call(t.$)}})},show_:function(){return this.state<=i&&this.parent.$.append(this.$),this.show()},hide:function(){return this.$.hide(),(new e["class"].Deferred).resolve()},show:function(){return this.$.show(),(new e["class"].Deferred).resolve()}}),e.define(p,"View",g)}(),e.registerHandler("ViewManager",p)});
//# sourceMappingURL=views.min.js.map