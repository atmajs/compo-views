"use strict";/*!
 * Form Component v0.10.38
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2018 Atma.js and other contributors
 */
!function(t,e){function n(t,e){var n=i[t]||i.atma&&i.atma[t];if(null!=n)return n;if("function"==typeof require)return require(e);throw Error(t+" was not loaded")}var i="undefined"!=typeof global?global:window,r=n("mask","maskjs"),o=n("ruta","ruta");e(i,r,r.jmask,r.Compo,r.Compo.config.getDOMLibrary(),o)}(void 0,function(t,e,n,i,r,o){var s;!function(){s=function(t){return e.obj.get(t,"req.url")||o.currentPath()}}();var a,u;!function(){u={NONE:0,LOADING:1,LOADED:2,RENDERING:3,RENDERED:4},a=e.class.create({viewNode:null,nodes:null,compo:null,route:null,state:u.NONE,path:null,default:!1,constructor:function(){for(var t=arguments.length,n=-1;++n<t;){var i=arguments.length<=n?void 0:arguments[n];null!=i&&(e.obj.extend(this,i),null!=i.view&&null==this.path&&(this.path=i.view))}},getNodes:function(){return null!=this.viewNode?(null!=this.path&&null==this.viewNode.nodes&&(this.viewNode.nodes=e.parse("import from '"+this.path+"'")),this.viewNode):null==this.nodes&&null!=this.path?this.nodes=e.parse("import from '"+this.path+"'"):this.nodes},toJSON:function(){return{route:this.route,state:this.state,path:this.path,viewNode:this.viewNode?e.stringify(this.viewNode):null,nodes:this.nodes?e.stringify(this.nodes):null}},createViewNode:function(t){var e=n(t);if(this.hasView_(e)===!1){var i=this.viewNode||n("View");return void(this.viewNode=n(i).append(t))}this.viewNode=e[0]},hasView_:function(t){if(1!==t.length)return!1;var e=t.tag();return e[0]===e[0].toUpperCase()}}),a.createFromNode=function(t){return new a({viewNode:t,route:t.attr.route,path:t.attr.path,default:Boolean(t.attr.default)})},a.createFromObj=function(t){return new a({route:t.route,path:t.path||t.view,default:Boolean(t.default)})}}();var c;!function(){function t(t,e){if(null==e)return t;if(null==t)return e;for(var n in e)null==t[n]&&(t[n]=e[n]);return t}c=e.class.create({views:null,constructor:function(){this.views=[]},add:function(t){this.views.push(t)},each:function(t){for(var e=this.views.length,n=-1;++n<e;)t(this.views[n])},toJSON:function(){return this.views.map(function(t){return t.toJSON()})}}),c.ensure=function(t,n,i){var r=t.viewmap;if(null!=r)return r;var r=new c,o=t.scope.viewmap;if(null==o&&t.xViewmap){var s=e.Utils.Expression.eval;o=s(t.xViewmap,n,i,t)}if(null==o&&e.is.NODE&&(o=c.getFromRoutes(t,i)),e.is.Array(o)){var u=o;u.map(a.createFromObj).forEach(function(t){r.add(new a(r[t.route],t))})}else if(e.is.Object(o)){var l=o;for(var h in l){var v=l[h];null==v.route&&(v.route=h),r.add(a.createFromObj(v))}}return e.jmask(t.nodes).filter("View").map(a.createFromNode).each(function(t){r.add(new a(r[t.route],t))}),t.viewmap=r},c.getFromRoutes=function(t,e){if(null==e.page||null==e.config)return null;var n,i,r=e.page.data,o=e.config.pages,s=[];for(n in o)i=o[n],i.template===r.template&&s.push(i);return s},c.createRoutes=function(t){for(var e=t.viewmap,n=e.views,i=n.length,r=-1;++r<i;){var o=n[r];t.routes.add(o.route,o)}},c.getRouteByPath=function(t,e){var n=t.routes,i=n.get(e);if(i)return i;for(var r=t.viewmap,s=r.views,a=s.length,u=-1;++u<a;){var c=s[u];if(1==c.default){var i=n.get(c.route);return i.definition.indexOf("?")>-1&&o.navigate(i.definition,{extend:!0,silent:!0,replace:!0}),i}}return null},c.getRouteByPathOrCurrentOrDefault=function(e,n,i){var r=e.routes,s=r.get(n),a=null!=s;if(null==s?s=e.route:t(s.current.params,i),null==s)for(var u=e.viewmap,c=u.views,l=c.length,h=-1;++h<l;){var v=c[h];if(1==v.default){s=r.get(v.route);break}}return null==s?null:(a===!1&&s.definition.indexOf("?")>-1&&o.navigate(s.definition,{extend:!0,silent:!0,replace:!0}),s)},c.bindRouter=function(t,e,n){var i=c.ensure(t,e,n);return null==i?void console.error("Viewmap is undefined"):void(t.xNested===!0&&t.isNested()===!0||i.each(function(e){o.add(e.route,function(e){var n=e.current,i=n.path,r=n.params;t.navigate(i,null,{params:r})})}))}}();var l;!function(){l=e.class.create({tickStart:null,tickEnd:null,history:null,vm:null,constructor:function(t){this.history=[],this.routes=[],this.vm=t,this.activityCounter=0,this.isBusy=!1},show:function(t,e){var n,i=this,r=this.routes.indexOf(t);return r===-1?(t.dfr=n=e(),this.routes.push(t)):n=this.routes[r].dfr,this.history.push({current:t.current,route:t}),this._requestProgressStart(),n.done(function(){return i._requestProgressEnd(t)}).fail(function(t){return console.error(t)})},clear:function(t){var e=this.routes.indexOf(t);e!==-1&&(t.dfr=null,t.value.compo=null,this.routes.splice(e,1))},_requestProgressStart:function(t){this._activity(1,t)},_requestProgressEnd:function(t){this._activity(-1,t)},_cancelProgressStart:function(){clearTimeout(this.tickStart)},_cancelProgressEnd:function(){clearTimeout(this.tickEnd)},_progressStart:function(t){this._cancelProgressStart(),this._cancelProgressEnd(),this.isBusy=!0,this.vm.emitIn("viewActivity","start")},_progressEnd:function(t){this._cancelProgressStart(),this._cancelProgressEnd(),this.isBusy=!1,this.vm.emitIn("viewActivity","end")},_activity:function(t,e){this._cancelProgressEnd(),this._cancelProgressStart(),(this.activityCounter+=t)<0&&(this.activityCounter=0);var n=this.activityCounter>0;n!==this.isBusy&&(n?this.tickStart=setTimeout(this._progressStart.bind(this,e)):this.tickEnd=setTimeout(this._progressEnd.bind(this,e)))},get current(){var t=this.history[this.history.length-1];return t&&t.route},back:function(){return this.history.pop(),this.history.pop()}})}();var h;!function(){function t(e,n,i){if(null==e)return null;var r=e.components;if(null==r)return null;for(var o=r.length,s=-1,a=null;++s<o;){var u=r[s],c=u.compoName||u.tagName;if("imports"===c||"import"===c){var l=t(u,n,i);if(l)return l}if("Animation"===c&&u.attr.id===n){var h=u.attr.for;if(null==h&&null==a&&(a=u),h===i)return u}}return a}h=e.class.create({vm:null,constructor:function(t){this.vm=t},show:function t(e,n,i){var r=this,t=this.getShow(e,n),o=this.getHide(n,e);return t.parallel?(this.hide_(o,n),void this.show_(t,e,i)):void this.hide_(o,n).then(function(){return r.show_(t,e,i)})},show_:function(t,n,i){var r=this;return e.class.Deferred.run(function(e){r.vm.showCompo_(n.value.compo,i).then(function(){var r=n.value.compo.$[0];t.start(e,r,{route:n,isInitial:i})})})},hide_:function(t,n){var i=this;return e.class.Deferred.run(function(e){return null==n.value.compo?void e():void t.start(function(){i.vm.hideCompo_(n.value.compo).then(e)},n.value.compo.$[0],{route:n})})},getShow:function(t,e){return this.getAniForRoute(t,"show",e)},getHide:function(t,e){return this.getAniForRoute(t,"hide",e)},getAniForCompo:function(e,n,i){return t(e,n,i)},getAniForRoute:function(t,e,i){var r=i.definition,o=this.getAniForCompo(t.value.compo,e,r);return null==o&&(o=this.getAniForCompo(this.vm,e,r)),o?o:n}});var n={attr:{},start:function(t){t()}}}();var v=e.Compo({tagName:"div",attr:{style:"position: relative",class:"v-manager"},meta:{attributes:{base:"",viewmap:"",routing:!0,nested:!0},serializeScope:!0},serializeScope:function(){return JSON.stringify(this.scope)},slots:{viewNavigate:function(t,e,n){if(t!==this){var i=this.route;i&&i.value&&i.value.compo;return this.navigate(e,n,{defaultView:!1}),!1}},viewActivation:function(t){if(t!==this){this.route&&this.route.value&&this.route.value.compo;return!1}},viewDeactivation:function(t){this.route&&this.route.value&&this.route.value.compo;return!1},back:function(t){var e=this.activityTracker.back();this.navigate(e.current.path)}},scope:{notificationMsg:"",notificationType:"",viewmap:null},viewmap:null,routes:null,route:null,next:null,activity:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.emitIn.apply(this,["views:activity",t].concat(n))},constructor:function(){this.routes=new o.Collection},onRenderStart:function(t,e){var r=this;c.ensure(this,t,e),c.createRoutes(this);var o=s(e),a=c.getRouteByPath(this,o);if(e.params=a&&a.current&&a.current.params,this.attr.path=o,this.route=a,this.nodes=n().add(this.getCompo_("Notification")).add(this.getCompo_("Progress")).add(this.getCompo_("Animation"),!1),null!=a){var u=a.value;if(null==u.path)return void this.nodes.add(u.getNodes()||n());var l=i.pause(this,e);this.loadView(a,t).done(function(t){r.nodes.add(u.getNodes()||n()),l()}).fail(function(){return l()})}},onRenderStartClient:function(t,e){c.ensure(this,t,e),c.createRoutes(this)},onRenderEndServer:function(){this.scope.viewmap=this.viewmap.toJSON()},onRenderEnd:function(t,e,n){var r=this;if(this.activityTracker=new l(this),this.viewChanger=new h(this),this.ctx=n,this.xRouting&&c.bindRouter(this,e,n),null==this.route&&null!=this.attr.path&&(this.route=c.getRouteByPath(this,this.attr.path)),null!=this.route){var o=this.route.value,s=this.find("View");null!=s&&s.emitIn("viewActivation"),o.compo=s,this.activityTracker.show(this.route,function(){return i.await(r)})}},getCtx:function(t){var n=e.obj.extend(null,this.ctx);return n.params=t.current.params,n},isNested:function(){var t=i.closest(this.parent,"ViewManager");return null!=t},navigate:function(t,n,i){var r=this,o=c.getRouteByPathOrCurrentOrDefault(this,t,i&&i.params),s=new e.class.Deferred;if(null==o)return s.reject("View not found: "+t);var a=null==o.value.compo;return o===this.route?(a===!1&&o.value.compo.emitIn("viewNavigate",t),s.resolve(o)):this.activityTracker.show(o,function(){return r.loadView(o,n).then(function(){return r.renderView(o,n)})}).done(function(){a===!1&&o.value.compo.emitIn("viewNavigate",t),r.performShow(o,a)})},hideCompo_:function(t){if(null!=t)return t.emitIn("viewDeactivation",this),t.hide_()},showCompo_:function(t,e){var n=this;return t.show_().then(function(){return t.emitIn("viewActivation",n)})},emit:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=i.pipe("views")).emit.apply(e,[t,this].concat(r))},loadView:function(t,n){return e.class.Deferred.run(function(n,i){var r=t.value;if(null!=r.viewNode)return void n(t);var o=r.path;e.Module.createModule(new e.Module.Endpoint(o,"mask")).loadModule().fail(i).done(function(e){var i=e.exports.__nodes__;r.createViewNode(i),n(t)})})},renderView:function(t,n){var r=this;return e.class.Deferred.run(function(o,s,a){if(t.value.compo)return void o(t);var u=r.getCtx(t);e.renderAsync(t.value.getNodes(),n||r.model,u,null,r).done(function(e,n){var r=n.components[n.components.length-1],s=i.prototype.find.call(r,"View");t.value.compo=s,o(t)})})},performShow:function(t,e){var n=this.route;n!==t&&(this.route=t,this.viewChanger.show(t,n,e),null!=n&&null!=n.value.compo&&n.value.compo.xRecycle===!0&&this.activityTracker.clear(n))},notify:function(t,e){0===arguments.length&&(t=e=""),this.scope.notificationType=t,this.scope.notificationMsg=e,this.emitIn("formNotification",{type:t,message:e})},getCompo_:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=n(this).children(t);return e===!1?i:0===i.length?n(t):i},throw_:function(t){this.nodes=e.parse("\n\t\t\tdiv style='background: red; color: white; padding: 15px; font-weight: bold' {\n\t\t\t\t\""+t.message+'"\n\t\t\t}\n\t\t')},errored_:function(t){this.activity("end"),this.activity("error",t),this.notify("danger",t.message||String(t))}}),f="\n\t// source Notification.mask\n\tlet Notification as (div) {\n\t\t\n\t\tslot formNotification () {\n\t\t\tvar form = this.closest('a:form');\n\t\t\tif (!form.scope.notificationMsg) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar el = this.$.get(0);\n\t\t\tif (el) {\n\t\t\t\tel.scrollIntoView(true);\n\t\t\t}\n\t\t}\n\t\t\n\t\t@if (template) {\n\t\t\t@template;\n\t\t}\n\t\t@else {\n\t\t\t+if (notificationMsg) {\n\t\t\t\t.alert.alert-~[bind: $scope.notificationType] > '~[bind: $scope.notificationMsg ]'\n\t\t\t}\n\t\t}\n\t}\n\t// end:source Notification.mask\n\t// source Progress.mask\n\tlet Progress {\n\t\tvar value = -1;\n\t\tvar progress = false;\n\t\n\t\tslot viewActivity (sender, type, percent) {\n\t\t\tif (type === 'start') {\n\t\t\t\tthis.scope.progress = true;\n\t\t\t}\n\t\t\tif (type === 'end') {\n\t\t\t\tthis.scope.progress = false;\n\t\t\t}\n\t\t\tif (type === 'progress' && typeof percent === 'number') {\n\t\t\t\tthis.scope.value = percent;\n\t\t\t}\n\t\t}\n\t\n\t\t.-a-views-progress style='display: ~[bind: $scope.progress ? \"block\" : \"none\" ]'{\n\t\n\t\t\tprogress value='~[bind: $scope.value == -1 ? null : $scope.value]' max=100;\n\t\n\t\t\tstyle scoped {\n\t\t\t\tprogress {\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\twidth: 98%;\n\t\t\t\t\theight: 3px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// end:source Progress.mask\n";e.define(v,f);var d;!function(){var t=1,n=2,r=3,o=4,s=5;d=i({meta:{attributes:{default:!1,display:{description:"Hides view when not visible",default:!1,type:"boolean"},detach:!0,recycle:!1}},slots:{viewDeactivation:function(){return this.state!==s&&void(this.state=s)}},tagName:"div",attr:{class:"v-view"},onRenderStart:function(){},state:t,hide_:function(){var t=this;return this.hide().then(function(){if(t.xRecycle===!0)return void t.remove();if(t.xDetach===!0){t.state=n;var e=t.$.detach||t.$.remove;e.call(t.$)}})},show_:function(){return this.state<=r&&this.parent.$.append(this.$),this.state===t&&(this.emitIn("domInsert"),this.state=r),this.show()},hide:function(){var t=this.xDisplay?o:s;return t===!1&&this.$.hide(),(new e.class.Deferred).resolve()},show:function(){var t=this.xDisplay?o:s;return t===!1&&this.$.show(),(new e.class.Deferred).resolve()}}),e.define(v,"View",d)}(),e.registerHandler("ViewManager",v)});
//# sourceMappingURL=views.min.js.map