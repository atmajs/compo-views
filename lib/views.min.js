/*!
 * Form Component v0.10.18
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2016 Atma.js and other contributors
 */
"use strict";!function(t,e){var n="undefined"!=typeof global?global:window,i=n.mask||n.atma&&n.atma.mask;if(null==i){if("function"!=typeof require)throw Error("MaskJS was not loaded");mask=require("maskjs")}e(n,i,i.jmask,i.Compo,i.Compo.config.getDOMLibrary())}(void 0,function(t,e,n,i,r){var o,s,a;!function(){s=function(t){return Object.prototype.toString.call(t).replace("[object ","").replace("]","")},function(){a=function(t){if(null==t||"object"!=typeof t)return t;var e,n=s(t);if("Date"===n)return new Date(t);if("Array"===n){e=[];for(var i=-1,r=t.length;++i<r;)e[i]=a(t[i]);return e}if("Object"===n){e={};for(var o in t)e[o]=a(t[o]);return e}return t}}(),o=function(t,e){var n=void 0===arguments[2]?{}:arguments[2];if(null==t)return n;var i=s(t);if("Array"===i)return t.forEach(function(t,i){o(t,e+"["+i+"]",n)}),n;if("Object"===i){e&&(e+=".");var r,a,u;for(r in t)if(a=t[r],u=e+r,null!=a){var i=s(a);switch(i){case"Object":case"Array":o(a,u,n);continue;case"String":case"Number":case"Boolean":case"Blob":case"File":u in n&&console.warn("ToFormData: Overwrite property",u),n[u]=a;continue;case"Date":n[u]=a.toISOString();continue;default:console.error("Possible type violation",i),n[u]=a;continue}}return n}switch(i){case"Date":t=t.toISOString();break;case"String":case"Number":case"Boolean":case"Blob":case"File":break;default:console.error("Possible type violation",i)}return e in n&&console.warn("ToFormData: Overwrite property",e),n[e]=t,n}}();var u;!function(){u=function(t,n){e.TreeWalker.walk(t,function(e){return e!==t?n(e):void 0})}}();var c;!function(){c=function(n){return e.obj.get(n,"req.url")||t.location.pathname+t.location.search}}();var l,h={NONE:0,LOADING:1,LOADED:2,RENDERING:3,RENDERED:4},f=e["class"].create({viewNode:null,nodes:null,compo:null,route:null,state:h.NONE,path:null,"default":!1,constructor:function(){for(var t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];for(var r=n.length,o=-1;++o<r;){var s=n[o];null!=s&&e.obj.extend(this,s)}},getNodes:function(){return null!=this.viewNode?(null!=this.path&&null==this.viewNode.nodes&&(this.viewNode.nodes=e.parse("import from '"+this.path+"'")),this.viewNode):this.nodes}}),v={ensure:function(t,n,i){var r=t.viewmap;if(null!=r)return r;var o=e.Utils.Expression.eval;return r=t.scope.viewmap||t.xViewmap&&o(t.xViewmap,n,i,t)||{},e.jmask(t.nodes).filter("View").map(v.createViewDataFromNode).each(function(t){r[t.route]=new f(r[t.route],t)}),t.viewmap=r},createRoutes:function(t){for(var e in t.viewmap)t.routes.add(e,t.viewmap[e])},createViewDataFromNode:function(t){return new f({viewNode:t,route:t.attr.route,path:t.attr.path,"default":Boolean(t.attr["default"])})},getRouteByPath:function(t,e){var n=t.routes,i=n.get(e);if(i)return i;var r=t.viewmap;for(var o in r)if(r[o]["default"]===!0)return n.get(o);return null},bindRouter:function(t,e,n){var i=v.ensure(t,e,n);if(null==i)return void console.error("Viewmap is undefined");if(t.xNested!==!0||t.isNested()!==!0)for(var r in i)console.log("BIND",r),ruta.add(r,function(e){t.navigate(e.current.path)})}};!function(){l=e["class"].create(Object.defineProperties({tickStart:null,tickEnd:null,constructor:function(t){this.history=[],this.routes=[],this.vm=t},show:function(t,e){var n,i=this,r=this.routes.indexOf(t);return-1===r?(t.dfr=n=e(),this.routes.push(t)):n=this.routes[r].dfr,this.history.push(t),this.requestProgressStart(),n.done(function(){return i.requestProgressEnd(t)}).fail(function(){})},requestProgressStart:function(t){this.cancelProgressEnd(),this.tickStart=setTimeout(this.progressStart.bind(this,t))},requestProgressEnd:function(t){this.cancelProgressStart(),this.tickEnd=setTimeout(this.progressEnd.bind(this,t))},cancelProgressStart:function(){clearTimeout(this.tickStart)},cancelProgressEnd:function(){clearTimeout(this.tickEnd)},progressStart:function(){this.cancelProgressEnd(),this.vm.emitIn("viewActivity","start")},progressEnd:function(t){(null==t||this.current===t)&&(this.cancelProgressStart(),this.cancelProgressEnd(),this.vm.emitIn("viewActivity","end"))},history:null,active:!1,route:null,tick:null,vm:null},{current:{get:function(){return this.history[this.history.length-1]},configurable:!0,enumerable:!0}}))}();var p=e.Compo({tagName:"div",attr:{style:"position: relative","class":"v-manager"},meta:{attributes:{base:"",viewmap:"",routing:!0,nested:!0}},slots:{viewNavigate:function(t,e){var n=this;if(t!==this){var i=this.route,r=i&&i.value&&i.value.compo;return this.navigate(e,{defaultView:!1}).done(function(){i===n.route&&r.emitIn("viewActivation",n.route.current.params)}),!1}},viewActivation:function(t){if(t!==this){this.route&&this.route.value&&this.route.value.compo;return!1}},viewDeactivation:function(t){var e=this.route&&this.route.value&&this.route.value.compo;return e&&e.emitIn("viewDeactivation"),!1}},scope:{notificationMsg:"",notificationType:""},viewmap:null,routes:null,route:null,next:null,activity:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;e>i;i++)n[i-1]=arguments[i];this.emitIn.apply(this,["views:activity",t].concat(n))},constructor:function(){this.routes=new ruta.Collection},onRenderStart:function(t,e){v.ensure(this,t,e),v.createRoutes(this);var n=c(e),i=v.getRouteByPath(this,n);this.route=i,this.nodes=i&&i.value.getNodes(),this.ensureCompo_("Notification"),this.ensureCompo_("Progress"),this.attr.path=n},onRenderEnd:function(t,e,n){var r=this;if(this.activityTracker=new l(this),v.ensure(this,e,n),this.xRouting&&v.bindRouter(this,e,n),null==this.route&&null!=this.attr.path&&(this.route=v.getRouteByPath(this,this.attr.path)),null!=this.route){var o=this.route.value,s=this.find("View");null!=s&&s.emitIn("viewActivation"),o.compo=s,this.activityTracker.show(this.route,function(){return i.await(r)})}},isNested:function(){var t=i.closest(this.parent,"ViewManager");return null!=t},navigate:function(t,n){var i=this,r=v.getRouteByPath(this,t);if(null==r){var o=new e["class"].Deferred;return n&&n.defaultView===!1?o.resolve(this.route):o.reject("View not found: "+t)}var s=null==r.value.compo;return this.activityTracker.show(r,function(){return i.renderView(r)}).done(function(){s===!1&&r.value.compo.emitIn("viewNavigate",t),i.performShow(r)})},hideCompo_:function(t){null!=t&&(t.emitIn("viewDeactivation",this),t.hide_())},showCompo_:function(t){null!=t&&(t.emitIn("viewActivation",this),t.show_())},emit:function(t){for(var e,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];(e=i.pipe("views")).emit.apply(e,[t,this].concat(r))},activate:function(t){compo.emitIn("viewActivation",t.current.params)},renderView:function(t){var n=this;return e["class"].Deferred.run(function(r,o,s){if(t.value.compo)return void r(t);var a=t.current&&t.current.params;e.renderAsync(t.value.getNodes(),{params:a},null,null,n).done(function(e,n){var o=n.components[n.components.length-1],s=i.prototype.find.call(o,"View");t.value.compo=s,r(t)})})},performShow:function(t){var e=this.route;e!==t&&(this.route=t,this.hideCompo_(e.value.compo),this.showCompo_(t.value.compo))},notify:function(t,e){0===arguments.length&&(t=e=""),this.scope.notificationType=t,this.scope.notificationMsg=e,this.emitIn("formNotification",{type:t,message:e})},ensureCompo_:function(t){var e=jmask(this).children(t);0===e.length&&jmask(this).prepend(t)},throw_:function(t){this.nodes=e.parse("\n			div style='background: red; color: white; padding: 15px; font-weight: bold' {\n				\""+t.message+'"\n			}\n		')},errored_:function(t){this.activity("end"),this.activity("error",t),this.notify("danger",t.message||String(t))}}),d="\n	// source Notification.mask\n	let Notification as (div) {\n		\n		slot formNotification () {\n			var form = this.closest('a:form');\n			if (!form.scope.notificationMsg) {\n				return;\n			}\n			var el = this.$.get(0);\n			if (el) {\n				el.scrollIntoView(true);\n			}\n		}\n		\n		@if (template) {\n			@template;\n		}\n		@else {\n			+if (notificationMsg) {\n				.alert.alert-~[bind: $scope.notificationType] > '~[bind: $scope.notificationMsg ]'\n			}\n		}\n	}\n	// end:source Notification.mask\n	// source Progress.mask\n	let Progress {\n		var value = -1;\n		var progress = false;\n	\n		slot viewActivity (sender, type, percent) {\n			if (type === 'start') {\n				this.scope.progress = true;\n			}\n			if (type === 'end') {\n				this.scope.progress = false;\n			}\n			if (type === 'progress' && typeof percent === 'number') {\n				this.scope.value = percent;\n			}\n		}\n	\n		.-a-views-progress style='display: ~[bind: $scope.progress ? \"block\" : \"none\" ]'{\n	\n			progress value='~[bind: $scope.value == -1 ? null : $scope.value]' max=100;\n	\n			style scoped {\n				progress {\n					display: block;\n					margin: auto;\n					width: 98%;\n					height: 3px;\n				}\n			}\n		}\n	}\n	// end:source Progress.mask\n";e.define(p,d);var m;!function(){var t=1,n=2,r=3,o=5;m=i({meta:{attributes:{"default":!1,detach:!0}},slots:{viewDeactivation:function(){return this.state===o?!1:void(this.state=o)}},tagName:"div",attr:{"class":"v-view",style:"position:relative"},onRenderStart:function(){},state:t,hide_:function(){var t=this;this.hide().then(function(){t.xDetach===!0&&(t.state=n,t.$.remove())})},show_:function(){this.state<=r&&this.parent.$.append(this.$),this.show()},hide:function(){return this.$.hide(),(new e["class"].Deferred).resolve()},show:function(){return this.$.show(),(new e["class"].Deferred).resolve()}}),e.define(p,"View",m)}(),e.registerHandler("ViewManager",p)});
//# sourceMappingURL=views.min.js.map